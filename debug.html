<!DOCTYPE html>
<html>
<head>
    <title>调试下拉框</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .col {
            flex: 1;
        }
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #debug-output {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-top: 20px;
            min-height: 200px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SLM 下拉框调试</h1>
        
        <div class="row">
            <div class="col">
                <label for="family-select">SLM Family:</label>
                <select id="family-select">
                    <option value="">选择一个SLM家族...</option>
                    <option value="Llama3.2">LLaMA 3.2 family</option>
                    <option value="DeepSeek-R1">DeepSeek-R1 family</option>
                    <option value="Qwen">Qwen family</option>
                </select>
            </div>
            
            <div class="col">
                <label for="model-select">SLM Model:</label>
                <select id="model-select">
                    <option value="">选择一个SLM模型...</option>
                </select>
            </div>
        </div>
        
        <button id="load-data">加载模型数据</button>
        <button id="log-elements">检查DOM元素</button>
        <button id="clear-log">清除日志</button>
        
        <div id="debug-output"></div>
    </div>

    <script>
        // 全局变量
        let modelData = null;
        const debugOutput = document.getElementById('debug-output');
        const familySelect = document.getElementById('family-select');
        const modelSelect = document.getElementById('model-select');
        
        // 记录日志的函数
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            debugOutput.innerHTML += `[${timestamp}] ${message}\n`;
            debugOutput.scrollTop = debugOutput.scrollHeight;
            console.log(message);
        }
        
        // 清除日志
        document.getElementById('clear-log').addEventListener('click', () => {
            debugOutput.innerHTML = '';
        });
        
        // 检查DOM元素
        document.getElementById('log-elements').addEventListener('click', () => {
            log(`家族选择框: ${familySelect ? "已找到" : "未找到"}`);
            log(`模型选择框: ${modelSelect ? "已找到" : "未找到"}`);
        });
        
        // 加载模型数据
        document.getElementById('load-data').addEventListener('click', () => {
            log("开始加载模型数据...");
            
            // 两种路径都尝试
            const paths = [
                './website/examples/model_series_order.json',
                '/website/examples/model_series_order.json'
            ];
            
            let loadSuccess = false;
            
            // 尝试第一个路径
            fetch(paths[0])
                .then(response => {
                    log(`路径1 响应状态: ${response.status}`);
                    if (!response.ok) throw new Error(`路径1加载失败: ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    loadSuccess = true;
                    modelData = data;
                    log("路径1 成功加载模型数据");
                    log(`数据示例: ${JSON.stringify(data['Llama3.2']).slice(0, 50)}...`);
                })
                .catch(error => {
                    log(`路径1 错误: ${error.message}`);
                    
                    if (!loadSuccess) {
                        // 如果第一个路径失败，尝试第二个路径
                        log("尝试路径2...");
                        return fetch(paths[1]);
                    }
                })
                .then(response => {
                    if (!response || loadSuccess) return null;
                    
                    log(`路径2 响应状态: ${response.status}`);
                    if (!response.ok) throw new Error(`路径2加载失败: ${response.statusText}`);
                    return response.json();
                })
                .then(data => {
                    if (!data || loadSuccess) return;
                    
                    modelData = data;
                    log("路径2 成功加载模型数据");
                    log(`数据示例: ${JSON.stringify(data['Llama3.2']).slice(0, 50)}...`);
                })
                .catch(error => {
                    if (!loadSuccess) {
                        log(`所有路径都失败: ${error.message}`);
                        log("使用硬编码备用数据");
                        
                        // 使用硬编码数据作为后备方案
                        modelData = {
                            "Llama3.2": [
                                "llama3_2_1b_instruct",
                                "llama3_2_3b_instruct"
                            ],
                            "DeepSeek-R1": [
                                "DeepSeek-R1-Distill-Qwen-1.5B",
                                "DeepSeek-R1-Distill-Qwen-7B"
                            ],
                            "Qwen": [
                                "qwen_1_8b_chat",
                                "qwen_7b_chat"
                            ]
                        };
                    }
                });
        });
        
        // 家族选择变化事件
        familySelect.addEventListener('change', function() {
            const selectedFamily = this.value;
            log(`选择的家族: ${selectedFamily}`);
            
            // 清空模型选择框
            modelSelect.innerHTML = '<option value="">选择一个SLM模型...</option>';
            
            if (!selectedFamily) {
                log("未选择家族，不填充模型选项");
                return;
            }
            
            if (!modelData) {
                log("模型数据未加载，无法填充选项");
                return;
            }
            
            const models = modelData[selectedFamily];
            
            if (models && models.length > 0) {
                log(`找到 ${models.length} 个模型，开始填充选项...`);
                
                models.forEach(model => {
                    const option = document.createElement('option');
                    option.value = model;
                    option.textContent = model;
                    modelSelect.appendChild(option);
                });
                
                log(`已添加 ${models.length} 个模型选项`);
                log(`模型选择框现有 ${modelSelect.options.length} 个选项`);
            } else {
                log(`未找到家族 ${selectedFamily} 的模型`);
            }
        });
        
        // 模型选择变化事件
        modelSelect.addEventListener('change', function() {
            log(`选择的模型: ${this.value}`);
        });
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            log("页面已加载完成");
        });
    </script>
</body>
</html> 